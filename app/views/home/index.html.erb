<h1>Welcome, <%= current_user.first_name %>!</h1>
<%= button_to "Log Out", logout_path, method: :delete, data: { turbo: false } %>

<% if flash[:notice] %>
  <div class="alert alert-success"><%= flash[:notice] %></div>
<% elsif flash[:alert] %>
  <div class="alert alert-danger"><%= flash[:alert] %></div>
<% end %>

<% if @events && @events.any? %>
  <h2>Here are your events:</h2>
  <ul>
    <% @events.each do |event| %>
      <li>
        <!-- Change 1: Added link_to helper to make the event title clickable -->
        <h3><%= link_to event.title, event_path(event) %></h3>

        <p><strong>Location:</strong> <%= event.location %></p>
        <p><strong>Description:</strong> <%= event.description %></p>
        
        <!-- Change 2: Updated to format start_date and end_date -->
        <p><strong>Date:</strong> <%= event.start_date.strftime('%b %d, %Y') %> to <%= event.end_date.strftime('%b %d, %Y') %></p>

        <!-- Change 3: Removed GuestList reference and replaced it with direct query on guests -->
        <% guest_entry = event.guests.find_by(user: current_user) %>
        
        <!-- Change 4: Updated RSVP form to reflect direct Guest model usage -->
        <%= form_with url: update_attendance_guests_path, method: :patch, local: true do |form| %>
          <%= form.hidden_field :event_id, value: event.id %>
          <%= form.radio_button :rsvp_status, 'accepted', checked: guest_entry&.rsvp_status == 'accepted' %>
          <%= form.label :rsvp_status_accepted, 'Accepted' %>
          <%= form.radio_button :rsvp_status, 'declined', checked: guest_entry&.rsvp_status == 'declined' %>
          <%= form.label :rsvp_status_declined, 'Declined' %>
          <%= form.radio_button :rsvp_status, 'pending', checked: guest_entry&.rsvp_status == 'pending' %>
          <%= form.label :rsvp_status_pending, 'Pending' %>
          <%= form.submit 'RSVP' %>
        <% end %>
      </li>
    <% end %>
  </ul>
<% else %>
  <p>You currently have no events.</p>
<% end %>
